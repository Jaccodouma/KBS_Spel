#pragma once

#include "lib.h"
#include "golist.h"

#include "player.h"
#include "block.h"
#include "bomb.h"

class Game {
   public:
    Player* players[2] = {NULL, NULL};

    Game(uint8_t width, uint8_t height);
    ~Game();

    bool start();
    bool isStarted();
    bool gridCollision(position p);
    Gameobject * hasCollision(Gameobject *go, position p);
    bool addPlayer(Player *p);
    void update();
    void movePlayer(Player *p, direction d);
    void bombExplosion(Bomb *bomb);
    void plantBomb(Player *p);
    void addGameobject(Gameobject *go);
    void updateScores(Player *p);
    uint8_t getWidth();
    uint8_t getHeight();

   private:
    Gfx gfx;
    GoList gos;
    uint8_t width, height;
    unsigned long prevUpdate = millis();
    bool started = false;

    void drawScoreboard();
    void drawLevel();
    void addRandomBlocks();
    bool addExplosion(char x, char y, Player *p);
    void drawGrid();
    void drawGridBlock(int x, int y);
};

const uint8_t hearth[][32] PROGMEM = {
    {
   0x38, 0x18, 0x7c, 0x3c, 0xc2, 0x66, 0x81, 0xc3, 0x01, 0x80, 0x01, 0x80,
   0x01, 0x80, 0x01, 0xc0, 0x06, 0x60, 0x0c, 0x30, 0x18, 0x18, 0x18, 0x0c,
   0x30, 0x06, 0x60, 0x03, 0xc0, 0x03, 0x80, 0x01 },
   {
   0x00, 0x00, 0x00, 0x00, 0x3c, 0x18, 0x62, 0x3c, 0xf2, 0x7f, 0xfe, 0x7f,
   0xfe, 0x7f, 0xf2, 0x3f, 0xf8, 0x1f, 0xf0, 0x0f, 0xe0, 0x07, 0xe0, 0x03,
   0xc0, 0x01, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00 },
   {
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x0c, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }};